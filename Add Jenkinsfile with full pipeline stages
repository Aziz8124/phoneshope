pipeline {
    agent any

    tools {
        maven 'Maven_3.8.8'    // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø³Ù…Ù‰ Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù…Ø§ Ù‡Ùˆ Ù…Ø¹Ø±Ù ÙÙŠ Jenkins
        jdk 'Java_17'          // ØªØ£ÙƒØ¯ Ø£Ù† Java 17 Ù…Ø¹Ø±Ù ÙÙŠ Jenkins
    }

    stages {

        // ğŸ§© 1. Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† GitHub
        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/Aziz8124/phoneshope.git'
            }
        }

        // ğŸ› ï¸ 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Maven
        stage('Build') {
            steps {
                bat 'mvn clean package'
            }
        }

        // ğŸ§ª 3. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¢Ù„ÙŠØ©
        stage('Test') {
            steps {
                bat 'mvn test'
            }
        }

        // ğŸ” 4. ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù† (Ø«ØºØ±Ø§Øª ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª)
        stage('Security Scan') {
            steps {
                bat 'mvn org.owasp:dependency-check-maven:check'
            }
        }

        // ğŸ“¦ 5. Ø£Ø±Ø´ÙØ© Ù…Ù„Ù JAR Ø§Ù„Ù†Ø§ØªØ¬
        stage('Archive Artifact') {
            steps {
                archiveArtifacts artifacts: 'target\\*.jar', fingerprint: true
            }
        }

        // ğŸš€ 6. ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡
        stage('Deploy') {
            steps {
                bat 'start /B java -jar target\\phoneshope-0.0.1-SNAPSHOT.jar'
            }
        }
    }

    // ğŸ“© 7. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­ Ø£Ùˆ Ø§Ù„ÙØ´Ù„
    post {
        success {
            mail to: 'your_email@example.com',
                 subject: "âœ… Build Success: ${env.JOB_NAME}",
                 body: "Build #${env.BUILD_NUMBER} completed successfully."
        }
        failure {
            mail to: 'your_email@example.com',
                 subject: "âŒ Build Failed: ${env.JOB_NAME}",
                 body: "Build #${env.BUILD_NUMBER} failed. Check Jenkins for details."
        }
    }
}
