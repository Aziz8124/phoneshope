pipeline {
    agent any

    environment {
        // المسار الكامل لـ ZAP مع علامات اقتباس
        ZAP_PATH = '"C:\\Program Files\\ZAP\\Zed Attack Proxy\\zap.bat"'
        ZAP_PORT = '8090'
    }

    stages {

        stage('Start ZAP') {
            steps {
                echo "Starting ZAP in daemon mode..."
                bat "${env.ZAP_PATH} -daemon -port ${env.ZAP_PORT} -config api.disablekey=true"
            }
        }

        stage('Run ZAP Scan') {
            steps {
                echo "Running active scan..."
                // مثال على تشغيل scan على موقع محدد
                bat """
                curl http://localhost:8090/JSON/ascan/action/scan/?url=http://example.com
                """
            }
        }

        stage('Stop ZAP') {
            steps {
                echo "Stopping ZAP..."
                // إيقاف ZAP عبر API
                bat """
                curl http://localhost:8090/JSON/core/action/shutdown/
                """
            }
        }
    }

    post {
        always {
            echo "Cleaning up..."
            // أي أوامر تنظيف إضافية لو لزم
        }
    }
}
